package tests

import (
	"net/http"
	"testing"
)

func TestProfileUpdateAvatar(t *testing.T) {

	// Arrange
	loginResp := login(t, adminEmail, adminPassword)
	avatar := []byte{
		0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a,
		0x00, 0x00, 0x00, 0x0d, 0x49, 0x48, 0x44, 0x52,
		0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01,
		0x08, 0x02, 0x00, 0x00, 0x00, 0x90, 0x77, 0x53,
		0xde, 0x00, 0x00, 0x00, 0x0a, 0x49, 0x44, 0x41,
		0x54, 0x08, 0xd7, 0x63, 0x60, 0x00, 0x00, 0x00,
		0x02, 0x00, 0x01, 0xe2, 0x26, 0x05, 0x9b, 0x00,
		0x00, 0x00, 0x00, 0x49, 0x45, 0x4e, 0x44, 0xae,
		0x42, 0x60, 0x82,
	}

	// Act
	status, body := doMultipart(t, "/api/v1/identity/profile/avatar", "avatar", "avatar.png", avatar, loginResp.AccessToken)

	// Assert
	if status != http.StatusNoContent {
		errEnv := decodeError(t, body)
		t.Fatalf("profile avatar failed: status=%d message=%q", status, errEnv.Message)
	}
}
